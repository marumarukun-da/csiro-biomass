CSIRO - Image2Biomass Predictionコンペティションの要約

牧草地の画像からバイオマス量（飼料となる草の量）を予測する、農業×Computer Visionの回帰タスクです。

---

### コンペ背景

- **課題:** 農家にとって「家畜のために十分な牧草があるか？」を知ることは、放牧計画、動物福祉、土壌の健全性を保つ上で極めて重要です。
- **現状の問題点:** 従来の手動による刈り取り・計量は正確ですが時間がかかり、広範囲には適用できません。プレートメーターやリモートセンシングなどの既存技術も、変動する条件下では信頼性が低かったり、手動検証が必要だったりする課題があります。
- **目的:** 画像、実測値、公開データセットを活用し、より正確でスケーラブルな牧草バイオマス推定モデルを構築することで、持続可能な農業システムを支援することを目指します。

### コンペ概要

- **タスク:** オーストラリアの様々な季節、地域、草種を含む牧草地の画像、地上実測値（Ground-truth）、およびNDVI（正規化植生指標）などの公開データセットを用いて、牧草のバイオマス量を予測します。
- **データ:** 専門家によってアノテーションされたデータセットが提供されます。
- **予測対象:** 1つの画像ID（sample_id）に対し、以下の5つのターゲット変数を予測する必要があります（Long形式での提出）。
    1. `Dry_Green_g`（乾燥緑色草重量）
    2. `Dry_Dead_g`（乾燥枯草重量）
    3. `Dry_Clover_g`（乾燥クローバー重量）
    4. `GDM_g`（Green Dry Matter：緑色乾燥物質重量）
    5. `Dry_Total_g`（乾燥総重量）

### 評価指標

**Globally Weighted Coefficient of Determination (Weighted $R^2$)**

個々のターゲットごとに$R^2$を計算して平均するのではなく、**全ての（画像, ターゲット）ペアをまとめて**、以下の重みに基づいて計算された加重$R^2$スコアで評価されます。

$R^2_w = 1 - \frac{\sum_j w_j (y_j - \hat{y}_j)^2}{\sum_j w_j (y_j - \bar{y}_w)^2}$

$\bar{y}_w = \frac{\sum_j w_j y_j}{\sum_j w_j}$（全データのグローバル重み付き平均）

ここで、$w_j$はターゲットの種類に応じた重みです：

- **Dry_Total_g:** 0.5 （最も重要）
- **GDM_g:** 0.2
- **Dry_Green_g / Dry_Dead_g / Dry_Clover_g:** 各0.1

---

### 評価指標の詳細解説

#### R²（決定係数）とは

**モデルの予測が、単純に平均値を予測するよりどれだけ良いか**を示す指標です。

$$R^2 = 1 - \frac{SS_{res}}{SS_{tot}}$$

- **SS_res（残差二乗和）**: 予測がどれだけ外れたか
- **SS_tot（全変動）**: データが平均からどれだけばらついているか

| R²の値 | 意味 |
|--------|------|
| 1.0 | 完璧な予測（誤差ゼロ） |
| 0.0 | 平均値を予測するのと同じ性能 |
| 負の値 | 平均値を予測するより悪い |

#### 今回の評価指標の特徴

**通常のマルチターゲットR²との違い:**

| 方式 | 計算方法 |
|------|----------|
| 通常 | 各ターゲットごとにR²を計算 → 平均 |
| 今回 | 全（サンプル × ターゲット）ペアをまとめて1つのR²を計算 |

#### 具体例による計算

3サンプル × 2ターゲットの場合：

```
              Dry_Total_g(w=0.5)   GDM_g(w=0.2)
Sample1:  真値=100, 予測=110      真値=40, 予測=45
Sample2:  真値=150, 予測=140      真値=60, 予測=55
Sample3:  真値=200, 予測=210      真値=80, 予測=75
```

**Step 1: 全データを1列に並べる**
```
真値 y:    [100, 150, 200, 40, 60, 80]
予測 ŷ:    [110, 140, 210, 45, 55, 75]
重み w:    [0.5, 0.5, 0.5, 0.2, 0.2, 0.2]
```

**Step 2: グローバル重み付き平均**
$$\bar{y}_w = \frac{0.5(100+150+200) + 0.2(40+60+80)}{0.5 \times 3 + 0.2 \times 3} = \frac{261}{2.1} = 124.29$$

**Step 3: SS_res（予測誤差）**
```
Dry_Total_g: 0.5×(100-110)² + 0.5×(150-140)² + 0.5×(200-210)² = 150
GDM_g:       0.2×(40-45)² + 0.2×(60-55)² + 0.2×(80-75)² = 15
SS_res = 165
```

**Step 4: SS_tot（全体の分散）**
```
Dry_Total_g: 0.5×[(100-124.29)² + (150-124.29)² + (200-124.29)²] = 3495.1
GDM_g:       0.2×[(40-124.29)² + (60-124.29)² + (80-124.29)²] = 2638.3
SS_tot = 6133.4
```

**Step 5: R²_w**
$$R^2_w = 1 - \frac{165}{6133.4} = 0.973$$

#### 重要なポイント

1. **異なるスケールのターゲットが混在**: Dry_Total_g（数百〜数千）とDry_Clover_g（数十）が同じ「グローバル平均」から評価される
2. **SS_totが膨らみやすい**: GDM_g=40〜80 も平均124.29から評価されるため、分母が大きくなる
3. **大きな値のターゲットが支配的**: 二乗誤差なので、値が大きいターゲットの誤差の絶対値が大きくなる

---

### コンペで勝つための戦略

#### 1. Dry_Total_gの予測精度を最優先

- 重み0.5で全体の半分を占める
- 値のスケールも大きいため、SS_resへの寄与が最大
- **Dry_Total_gの誤差を1減らすことは、Dry_Clover_gの誤差を5減らすことに相当**

#### 2. ターゲット間の物理的関係を活用

5つのターゲットは独立ではなく、以下の関係がある：
```
Dry_Total_g = GDM_g + Dry_Dead_g
GDM_g = Dry_Green_g + Dry_Clover_g
```

したがって、**3つ（Dry_Total_g, GDM_g, Dry_Green_g）を予測すれば残り2つは導出可能**：
```
Dry_Dead_g = Dry_Total_g - GDM_g
Dry_Clover_g = GDM_g - Dry_Green_g
```

#### 3. 導出変数の誤差伝播に注意

Dry_Dead_gとDry_Clover_gは導出されるため、元の予測の誤差が伝播する：
- Dry_Total_gとGDM_gの両方がずれると、Dry_Dead_gの誤差は増幅される可能性
- 予測値が物理的制約を満たすよう、負の値は0にクリップするなどの後処理が有効

#### 4. 損失関数と評価指標の乖離を意識

| | 訓練時 | 評価時 |
|---|---|---|
| 指標 | Weighted Smooth L1 | Weighted R² |
| 計算 | 各ターゲット別々 → 重み付き合計 | 全ペアをまとめてグローバル計算 |

訓練lossが下がっても必ずしもR²が改善するとは限らない。バリデーションではR²を直接モニタリングすることが重要。

#### 5. 外れ値への対応

R²は二乗誤差ベースなので外れ値に敏感。データの外れ値処理や、ロバストな損失関数の検討が有効。

### コンペ期間

- **開始:** 2025年10月28日
- **エントリー締切:** 2026年1月21日
- **チーム合併締切:** 2026年1月21日
- 最終提出締切: 2026年1月28日
    
    (すべてUTC 11:59 PM)
    

### 賞金

- **1位:** $50,000
- **2位:** $20,000
- 3位: $5,000
    
    (賞金総額 $75,000)
    

### 制限事項

**Code Competition（Notebook提出のみ）**

- **実行時間制限:** CPU / GPU ともに9時間以内
- **インターネット:** **無効（Disabled）**
- **外部データ:** 公開されているものであれば使用可能（学習済みモデル含む）
- **提出ファイル:** `submission.csv` という名前で、指定されたLong形式であること。
