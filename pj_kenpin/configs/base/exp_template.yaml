# 実験の設定
experiment:
  name: exp000
  seed: 42
  output_dir: ./output/exp000
  notes: write your notes here


# データセットの設定
dataset:
  train_dir: ./data/yourdataset/train
  val_dir: ./data/yourdataset/val
  num_classes: 2
  img_size:
    - 224
    - 550


# 学習の設定
trainer:
  train_batch_size:
    - 16
    - 64
  val_batch_size: 64
  num_workers: 4
  num_epochs: 100
  use_amp: true
  label_smoothing: 0.05

  # クラス重み付け損失の設定
  # enabled: true/false - 重み付けのオン/オフ（リストでグリッドサーチ可）
  # mode: auto --> サンプル数から自動計算, manual --> weightsで指定
  # weights: mode=manual時に使用、クラス順のリスト [1.0, 2.0, ...]
  class_weighting:
    enabled: true
    mode: auto
    weights: []


# 最適化の設定
optimization:
  lr:
    - 1e-3
    - 1e-4
  weight_decay:
    - 1e-3
    - 1e-4
  warmup_rate:
    - 0.05
    - 0.1
  use_ema: true  # EMAのオン・オフ (グリッドサーチで [true, false] も可能)
  ema_decay: 0.995  # use_emaがtrueのときのみ使用
  ema_start_ratio: 0.1  # use_emaがtrueのときのみ使用


# モデルの設定
model:
  backbone:
    - tf_efficientnetv2_b0.in1k
    - tf_efficientnetv2_b1.in1k
  pretrained: True
  in_chans: 3
  head: arcface


# ArcFaceの設定
arcface:
  s: 2
  embedding_size: 512
  subcenter_num: 2

  # ArcFaceLossAdaptiveMarginの設定
  m_x: 0.1
  m_y: 0.6


# Augmentationの設定
augmentation:
  # Normalize設定（model.in_chansに応じて自動選択）
  normalize:
    rgb:
      mean:
        - 0.485
        - 0.456
        - 0.406
      std:
        - 0.229
        - 0.224
        - 0.225
    grayscale:
      mean:
        - 0.456
      std:
        - 0.224

  # トレーニング時のaugmentation
  train:
    horizontal_flip:
      p: 0.5

    vertical_flip:
      p: 0.5

    random_brightness_contrast:
      brightness_limit: 0.2
      contrast_limit: 0.2
      p: 0.25

    coarse_dropout:
      enabled: true
      num_holes_range: [10, 30]
      hole_height_range: [8, 16]
      hole_width_range: [8, 16]
      p: 0.25

  # バリデーションはResize + Normalizeのみ（自動）

