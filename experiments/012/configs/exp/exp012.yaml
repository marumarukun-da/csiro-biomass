__include__:
  - "../base/exp_template.yaml"

# Experiment settings
experiment:
  name: exp012
  seed: 42

# Dataset settings
dataset:
  # Paths are resolved by config.py (null = use default from config.py)
  train_csv: null
  image_dir: null

  img_size:
    - 640

# Training settings
trainer:
  train_batch_size: 2
  val_batch_size: 4
  gradient_accumulation_steps: 8  # Effective batch size = 2 * 8 = 16
  num_workers: 4
  num_epochs: 200
  use_amp: true
  n_folds: 5
  fold: null  # Train all folds
  group_col: site  # GroupKFold grouping column (State + Sampling_Date)

# Optimization settings (grid search)
optimization:
  lr:
    # - 1e-3
    # - 5e-4
    # - 2e-4
    - 1e-4
    - 5e-5
  weight_decay: 
    - 1e-2
    # - 1e-3
    # - 1e-4
  warmup_rate: 0.1
  use_ema: true
  ema_decay: 0.997
  ema_start_ratio: 0.025

# Model settings (grid search)
model:
  backbone:
    # - convnextv2_tiny.fcmae_ft_in22k_in1k
    - convnextv2_base.fcmae_ft_in22k_in1k
  pretrained: true
  num_outputs: 3
  dropout: 0.1
  hidden_size: 512

# Loss function (MultiTaskBiomassLoss)
# Regression weights: Total: 1.5, GDM: 0.9, Green: 0.3
# Auxiliary task weights: State classification: 0.2, Height regression: 0.2
loss:
  beta: 1.0
  regression_weights:
    - 1.0  # Dry_Total_g
    - 0.6  # GDM_g
    - 0.3  # Dry_Green_g
  classification_weight: 0.1  # State classification (CE loss)
  height_weight: 0.1  # Height_Avg_cm regression (Smooth L1 loss)

# Augmentation settings
augmentation:
  train:
    horizontal_flip:
      p: 0.5
    vertical_flip:
      p: 0.5
    random_brightness_contrast:
      brightness_limit: 0.2
      contrast_limit: 0.2
      p: 0.4
    coarse_dropout:
      num_holes_range:
        - 10
        - 40
      hole_height_range:
        - 20
        - 150
      hole_width_range:
        - 20
        - 150
      p: 0.3
    gaussian_blur:
      blur_limit:
        - 3
        - 7
      p: 0.3
    hue_saturation_value:
      hue_shift_limit: 10
      sat_shift_limit: 20
      val_shift_limit: 20
      p: 0.5
    random_gamma:
      gamma_limit:
        - 60
        - 140
      p: 0.5
    random_rotate90:
      p: 0.3

  mixup:
    enabled: true
    alpha: 
      # - 0.4
      # - 1.0
      - 2.5
    disable_ratio: 0.2  # Disable Mixup in the last 20% of training
